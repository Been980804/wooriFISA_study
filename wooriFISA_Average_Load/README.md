# ğŸ¦ ë¦¬ëˆ…ìŠ¤ì˜ í‰ê·  ë¶€í•˜ì— ëŒ€í•œ ì‹¬ì¸µì  ì´í•´

## ğŸ´ ì‹œìŠ¤í…œ ë¶€í•˜ íŒŒì•…

```
top

uptime
```
<br>

![img-1](https://github.com/user-attachments/assets/85f92840-7179-4d31-adf0-63eca448cb26)
<br>
- 12:17:29 â†’ í˜„ì¬ ì‹œê°„
- up 3:11 â†’ ì‹œìŠ¤í…œ ê°€ë™ ì‹œê°„
- 2 users â†’ ì‚¬ìš©ì ìˆ˜
- 0.14, 0.08, 0.05 â†’ 1ë¶„, 5ë¶„, 15ë¶„ ë™ì•ˆì˜ í‰ê·  ë¶€í•˜
    <br>
    > í‰ê·  ë¶€í•˜ë€?
    
    ë‹¨ìœ„ ì‹œê°„ ë™ì•ˆ ì‹¤í–‰ ê°€ëŠ¥ ë˜ëŠ” ì¤‘ë‹¨ ë¶ˆê°€ëŠ¥í•œ ìƒíƒœì˜ í”„ë¡œì„¸ìŠ¤ì˜ í‰ê·  ìˆ˜ (CPU ì‚¬ìš©ë¥ ê³¼ëŠ” ì§ì ‘ì ì¸ ê´€ë ¨ ì—†ìŒ)
    
    Ex) í‰ê·  ë¶€í•˜ = 2
    1. CPUê°€ 2ê°œ
    â†’ ëª¨ë“  CPUê°€ ì™„ì „íˆ ì‚¬ìš© ì¤‘
    
    2. CPUê°€ 4ê°œ
    â†’ 4ê°œì˜ CPUê°€ 50%ì”© ì‚¬ìš© ì¤‘
    
    3. CPUê°€ 1ê°œ
    â†’ 1ê°œì˜ CPUì—ì„œ ë‘ê°œì˜ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ê²½ìŸ ì¤‘
    > 

- 1ë¶„, 5ë¶„, 15ë¶„ì˜ ê°’ì´ ë¹„ìŠ·í•¨
    
    â†’ ì‹œìŠ¤í…œ ë¶€í•˜ê°€ ì•ˆì •ì ì„
    
- 1ë¶„ ê°’ì´ 15ë¶„ ê°’ë³´ë‹¤ í›¨ì”¬ ë‚®ìŒ
    
    â†’ ì§€ë‚œ 15ë¶„ ë™ì•ˆ ìƒë‹¹í•œ ë¶€í•˜ê°€ ìˆì—ˆì§€ë§Œ, ë§ˆì§€ë§‰ì— ë¶€í•˜ê°€ ê°ì†Œí•¨
    
- 1ë¶„ ê°’ì´ 15ë¶„ ê°’ë³´ë‹¤ í›¨ì”¬ ë†’ìŒ
    
    â†’ ë§ˆì§€ë§‰ 1ë¶„ì˜ ë¶€í•˜ê°€ ì¦ê°€í–ˆìŒ
    
    â†’ ì‹œìŠ¤í…œì— ê³¼ë¶€í•˜ê°€ ë°œìƒí–ˆìŒì„ ì˜ë¯¸
    
    â†’ ë¬¸ì œì˜ ì›ì¸ ë¶„ì„ ë° ìµœì í™” í•„ìš”
    
<br>

## ğŸ¼ ì‚¬ë¡€

### ğŸ¦Š ì‚¬ì „ì¤€ë¹„

- ì»´í“¨í„° êµ¬ì„± : CPU 2ê°œ, 8GB RAM
- ì‚¬ì „ ì„¤ì¹˜ íŒ¨í‚¤ì§€ : stress, sysstat
    - stress : ë¹„ì •ìƒì ì¸ í”„ë¡œì„¸ìŠ¤ë¡œ ì¸í•´ í‰ê·  ë¶€í•˜ê°€ ì¦ê°€í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” Linux ì‹œìŠ¤í…œ stress í…ŒìŠ¤íŠ¸ ë„êµ¬
    - sysstat : ì‹œìŠ¤í…œ ì„±ëŠ¥ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ë¶„ì„í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” Linux ì„±ëŠ¥ ë„êµ¬ í¬í•¨ (mpstat, pidstat ëª…ë ¹ì–´ ì‚¬ìš©)
        - mpstat : ê° CPUì— ëŒ€í•œ ì‹¤ì‹œê°„ ì„±ëŠ¥ ë©”íŠ¸ë¦­ê³¼ ëª¨ë“  CPUì— ëŒ€í•œ í‰ê·  ë©”íŠ¸ë¦­ í™•ì¸
        - pidstat : í”„ë¡œì„¸ìŠ¤ì˜ CPU, ë©”ëª¨ë¦¬ I/O ë° ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹˜ì— ëŒ€í•œ ì‹¤ì‹œê°„ ì„±ëŠ¥ ë©”íŠ¸ë¦­ í™•ì¸

```
sudo apt install stress sysstat
```
<br>

### ğŸº Test

- 3ê°œì˜ í„°ë¯¸ë„

```
# root ê³„ì •ìœ¼ë¡œ ì „í™˜
sudo su root
cd ~
```

1. ì‹¤ìŠµ ì‹œì‘ì „ í‰ê·  ë¶€í•˜ í™•ì¸
2. 
![img-2](https://github.com/user-attachments/assets/f998f0f0-e9b2-45c5-abf0-c50231e20c5b)

<br>

### ğŸ¶ ì‹œë‚˜ë¦¬ì˜¤ 1 : CPUë¥¼ ë§ì´ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤

```
# CPU ì‚¬ìš©ëŸ‰ì´ 100% ì¸ ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜
# terminal 1
stress --cpu 1 --timeout 600

# terminal 2
uptime

# terminal 3
mpstat -P ALL 5
pidstat -u 5 1
```

![img-3](https://github.com/user-attachments/assets/71bc77c3-8060-4150-90c0-2c3816e7d024)
â†’ í‰ê·  ë¶€í•˜ê°€ 1.00 ìœ¼ë¡œ ì²œì²œíˆ ì¦ê°€

<br><br>
![img-4](https://github.com/user-attachments/assets/6ddeb223-0e21-4d6f-af88-5d8f72d539e8)

![img-5](https://github.com/user-attachments/assets/0888e363-c74d-4126-be46-3defe1bd352e)

â†’ stress í”„ë¡œì„¸ìŠ¤ì˜ CPU ì‚¬ìš©ëŸ‰ì´ 100%ì„

<br><br>

### ğŸµ ì‹œë‚˜ë¦¬ì˜¤ 2 : I/O ì§‘ì•½ì  í”„ë¡œì„¸ìŠ¤

```
# terminal 1
stress -i 1 --timeout 600

# terminal 2
watch -d uptime

# terminal 3
mpstat -P ALL 5 1
pidstat -u 5 1
```

![img-6](https://github.com/user-attachments/assets/d767620e-204a-4b7d-bfbd-513a7f6f2393)

![img-7](https://github.com/user-attachments/assets/dcbeb131-362f-42be-9288-bcad915157a4)

![img-8](https://github.com/user-attachments/assets/802bb2bd-699e-45f1-8da9-a8004aeb2f89)

â†’ í‰ê·  ë¶€í•˜ê°€ 1.00 ì„ ë„˜ì–´ ì¦ê°€í•¨

â†’ í‰ê·  ë¡œë“œì˜ ì¦ê°€ ì´ìœ ëŠ” iowaitì˜ ì¦ê°€ë¡œ ì¸í•¨

â†’ ì—¬ì „íˆ stress ê³¼ì •ì— ì˜í•´ ë°œìƒí•¨

<br>

### ğŸ® ì‹œë‚˜ë¦¬ì˜¤ 3 : í”„ë¡œì„¸ìŠ¤ ìˆ˜ê°€ ë§ì€ ì‹œë‚˜ë¦¬ì˜¤

```
# ì‹œìŠ¤í…œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ìˆ˜ê°€ CPUì˜ ì²˜ë¦¬ ìš©ëŸ‰ì„ ì´ˆê³¼ í•  ì‹œ
CPUë¥¼ ê¸°ë‹¤ë¦¬ëŠ” í”„ë¡œì„¸ìŠ¤ ë°œìƒ

# terminal 1
stress -c 8 --timeout 600

# terminal 2
uptime

# terminal 3
pidstat -u 5 1
```
![img-9](https://github.com/user-attachments/assets/5e999826-0fe9-4863-8de0-30f187a648c9)

![img-10](https://github.com/user-attachments/assets/12217ac9-de12-4ac5-8c99-d6706af3ca54)

â†’ 8ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ 2ê°œì˜ CPUë¥¼ ë‚˜ëˆ  ì‚¬ìš©í•˜ì—¬ ìµœëŒ€ 75%ì˜ ì‹œê°„ë™ì•ˆ CPU ëŒ€ê¸°(wait) í•¨

â†’ CPU ê³¼ë¶€í•˜

<br>

## ğŸ¹ ê²°ë¡ 

- í‰ê·  ë¶€í•˜ê°€ ë†’ì€ ê²ƒì€ CPUë¥¼ ë§ì´ ì‚¬ìš©í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¡œ ì¸í•´ ë°œìƒ
- í‰ê·  ë¶€í•˜ê°€ ë†’ë‹¤ê³  CPU ì‚¬ìš©ëŸ‰ ë†’ì€ ê²ƒì€ ì•„ë‹˜
- ë˜í•œ, I/O ì‘ì—…ì´ ì¦ê°€í–ˆìŒì„ ë‚˜íƒ€ë‚¼ ìˆ˜ë„ ìˆìŒ
- mpstat, pidstat ì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶€í•˜ì˜ ì›ì¸ì„ ë¶„ì„ ê°€ëŠ¥

<br>

## ğŸ¯ ì°¸ê³ 
<https://blog.devgenius.io/deep-understanding-of-average-load-in-linux-74822e1dbcb1>

<br><br>
